# zsh/bash shared setup

# NOTE: custom/localized PATH settings in .extra

# # is mac silicon
# if [ "$(uname -m)" = "arm64" ]; then
#     brew_prefix='/opt/homebrew'
# else
#     brew_prefix='/usr/local'
# fi

# # init brew (adds it to PATH)
# # This is hardcoded for macOS silicon
# eval "$($brew_prefix/bin/brew shellenv)"

# Load our dotfiles like ~/.bash_prompt, etc…
#   ~/.extra can be used for settings you don’t want to commit,
#   Use it to configure your PATH, thus it being first in line.
# NOTE: this is the load order, so add needed commands etc. earlier
for file in ~/.{extra,exports,eval,aliases,functions}; do
    # shellcheck disable=SC1090
    [ -r "$file" ] && source "$file"
done
unset file

##
## command history
##

# timestamps for later analysis. www.debian-administration.org/users/rossen/weblog/1
export HISTTIMEFORMAT='%F %T '

# keep history up to date, across sessions, in realtime
#  http://unix.stackexchange.com/a/48113
export HISTCONTROL=ignoredups:erasedups         # no duplicate entries
export HISTSIZE=100000                          # big big history (default is 500)
export HISTFILESIZE=$HISTSIZE                   # big big history
which shopt > /dev/null && shopt -s histappend  # append to history, don't overwrite it

# Save and reload the history after each command finishes
export PROMPT_COMMAND="history -a; history -c; history -r; $PROMPT_COMMAND"

# ^ the only downside with this is [up] on the readline will go over all history not just this bash session.


##
## Env vars
## example below
##
# if [ $USER = "clebron@conde" ]; then

#     #
#     # check Condé Nast env vars
#     #

#     # for CNEV in "JENKINS_USER" "JENKINS_TOKEN" "COPILOT_INSTALL_DIRECTORY"; do
#     for CNEV in "JENKINS_USER" "JENKINS_TOKEN"; do
#         if [[ -z $CNEV ]]; then
#             echo "$CNEV is unset. It should be set in local \"~/.extra\" file";
#         fi;
#     done
#     unset CNEV
# fi

# # using `-z` instead of `! -v` to support bash 3
# if [[ -z $JAVA_HOME ]]; then
#     echo "JAVA_HOME is not set. If developing in Java this should be set in local \"~/.extra\" file";
# fi
